// Script to compile static/map.ts to static/map.js
// Run after any changes to static/map.ts
// deno task compile-map
import { transpile } from "@/scripts/deps.ts";

const target = "static/map/map.js";

const compileMap = async () => {
  const emitResult = await transpile("static_server/map.ts");

  const key = [...emitResult.keys()].find((k) =>
    k.includes("static_server/map.ts")
  );
  if (!key) {
    console.error("could not find map.ts source");
    return;
  }
  const mapJs = emitResult.get(key);

  const warning = "// This file is generated by compileMap.ts";
  await Deno.writeTextFile(target, `${warning}\n${mapJs}`);
};

async function denoFmt() {
  await new Deno.Command("deno", { args: ["fmt", target] }).spawn()
    .status;
}

await compileMap();
await denoFmt();
